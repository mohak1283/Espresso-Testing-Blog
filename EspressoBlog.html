<html lang=en>



<p><strong>Table of Contents:</strong></p>

<ol>  
<li><a href='#demo'>Demo</a></li>          
<li><a href='#introduction'>Introduction</a></li>
<li><a href='#what-is-espresso'>What is Espresso?</a></li>
<li><a href='#components-of-espresso'>Components of Espresso</a></li>

<li>
An Example:
<br>
<ol>

<li><a href='#EspressoApp'>Login App</a></li>
<li><a href='#dependencies'>Dependencies</a></li>
<li><a href='#ActivityLayout'>Designing Activity Layout</a></li>
<li><a href='#setupMainActivity'>Setting Up MainActivity</a></li>
<li><a href='#creatingTestClass'>Creating MainActivityTest Class</a></li>
<li><a href='#setupMainActivityTestClass'>Setting Up Basic Code in MainActivityTest Class</a></li>
<li><a href='#creatingLoginSuccessTest'>Creating Login Success Test</a></li>
<li><a href='#creatingLoginFailedTest'>Creating Login Failed Test</a></li>


</ol>
</ol>
</li>
</ul>
<br>
<br><br>


<h3 id='demo'>Demo</h3>
<br>
<div class="d-flex justify-content-center">
     <div style="flex-column flex:1;padding-right:5px;">
          <p class="text-center">LOGIN SUCCESS</p>
          <img class="img-fluid text-center" src = "/Users/mohakgupta/Downloads/loginsuccess.gif " "height="400" width="200">
     </div>
     <div style="flex-column flex:1;padding-left:5px;">
           <p class="text-center">LOGIN FAILED</p>
          <img class="img-fluid text-center" src = "/Users/mohakgupta/Downloads/loginfailed.gif" "height="400" width="200">
     </div>
</div>
<br><br><br>

<h3 id='introduction'>Introduction</h3>
<br>
In this blog I'm going to show you how to do UI testing with Espresso in Android.
<br><br><br>


<h3 id='what-is-espresso'>What is Espresso?</h3>
<br>
Espresso is basically a testing framework released by Google in 2013. Espresso testing framework is used for UI testing and it helps in writing reliable user interface tests. Espresso tests run on actual device or emulator and behave as if an actual user is using the app.
<br><br><br>


<h3 id='components-of-espresso'>Components of Espresso</h3>
<br>
There are three basic components of Espresso testing framework.<br><br>
<ul>
<li><b>ViewMatchers</b><br><br>
ViewMatchers is basically a collection of hamcrest Matchers which locate a view in a current view hierarchy.
</li>
<br><br>
<li><b>ViewActions</b><br><br>
ViewActions is a collection of ViewAction objects which is used to perform some actions on the specified view, like click(), typeText(), etc.
</li>
<br><br>
<li><b>ViewAssertions</b><br><br>
ViewAssertions is a collection of ViewAssertion objects which is used to check if the specified view does what we expected.
</li>
</ul>
<br><br><br>


<h3 id='EspressoApp'>Login App</h3>
<br>
Now, Let's dive into the code. We will build the simple app in which there will be one email field and another one is password field. We will write two basic UI tests, in which we will check, if login is successfull or not. We will use hardcoded email id and password in this app.
<br><br>

Let's begin the coding!!!
<br><br><br>


<h3 id='dependencies'>Dependencies</h3>
<br>
Open build.gradle (Module:app) and add the following dependencies.
<br><br>
<script src="https://gist.github.com/mohak1283/d9b79215ad4994f3e85c44ba23438e50.js"></script>
<br>
Make sure you have the latest version of dependencies. You can check the latest version <a href="https://developer.android.com/training/testing/espresso/setup" target = "_blank" rel = "nofollow">here</a>
<br><br><br>


<h3 id='ActivityLayout'>Designing MainActivity Layout</h3>
<br>
Add the following code in your activity_main.xml file. 
This layout contains two edittexts for entering email id and password and Login Button is present below the edittexts and below this button one textview is present which displays the result<br><br>
<script src="https://gist.github.com/mohak1283/705e710e1e59522bd4070fabdea1d33e.js"></script>
<br><br><br>


<h3 id='setupMainActivity'>Setting Up MainActivity</h3>
<br>
In this section, we will setup the login code in MainActivity<br><br>
<ul>
<li>
First, Declare the EditText objects, Button object and TextView object inside the MainActivity class and find the reference of all these objects
in the onCreate() method using findViewById() method.<br><br>
<script src="https://gist.github.com/mohak1283/38ae2a0f7e8ba0620361523b3d04e99f.js"></script>
</li>
<li>
<p> Now, apply the OnClickListener on the Login Button present in the layout </p>
<p> In the below code, we are logging in using dummy email id and password. If the email id is <b>mohak123@gmail.com</b> and the password is <b>mohak123</b> then, set the <b>LOGIN SUCCESS!</b> text on TextView and if it's not, then set <b>LOGIN FAILED</b> text on TextView.</p>
<br><br>
<script src="https://gist.github.com/mohak1283/f54de0ad7a56dba00823c222eb6c799d.js"></script>
</li>
</ul>
<br><br><br>


<h3 id='creatingTestClass'>Creating MainActivityTest Class</h3>
<br>
In this section, we will see how to create MainActivityTest Class where we will write the UI test for MainActivity. You can create the test class for a particular activity using two methods 
<p><b>(Note: You can choose any method from these two)</b> </p>
<br><br> 
<ul>
<li><b>By right click on package name : </b>
<br><br>
This part we'll be focussing on creating the MainActivityTest class by right clicking on package name.
<br><br>
<ul>
<li>
Espresso tests are placed in <b>androidTest</b> folder. So, let's go to the <b>androidTest</b> folder and right click on it. After that, go to <b>New</b> and then go to <b>Java Class</b> option. Click on this option<br><br>
<div class="row  justify-content-center">
    <img class="img-fluid text-center" src = "/Users/mohakgupta/Desktop/creatingTestClass1.png">
</div>
</li>
<br><br>
<li>
Second, type the Test class name inside the <b>Create new class</b> Dialog box.
In this case, type <b>MainActivityTest</b> and press Enter. Now, your test class is created.
<br><br>
<div class="row  justify-content-center">
    <img class="img-fluid text-center" src = "/Users/mohakgupta/Desktop/creatingTestClass2.png">
</div>
</li>
</ul>
</li>
<br><br>

<li><b>By MainActivity Class : </b>
<br><br>
This part we'll see how you can create MainActivityTest class from MainActivity
<br><br>
<ul>
<li>
First, Go to MainActivity class and press <b>Alt+Enter</b> on it. There, you will see <b>Create Test Class</b> option. Select this option.<br><br>
<div class="row  justify-content-center">
    <img class="img-fluid text-center" src = "/Users/mohakgupta/Desktop/creatingTestClass3.png">
</div>
</li>
<li>
<p>Now, <b>Create Test</b> Dialog box appears. Choose the default options and press <b>OK</b> Button. </p>
<p>After that, <b>Choose Destination Directory</b> Dialog box appears. There select <b>/app/src/androidTest/java/your_package_name</b> directory and select <b>OK</b> Button. That's all, your MainActivityTest class is created.
<br><br>
<div class="row  justify-content-center">
    <img class="img-fluid text-center" src = "/Users/mohakgupta/Desktop/creatingTestClass4.png">
</div>
</li>
</ul>
</li>
</ul>
<br><br><br>

<h3 id='setupMainActivityTestClass'>Setting Up Basic Code in MainActivityTest Class</h3>
<br>
In this section, we will setup the basic code in MainActivityTest class<br><br>
<ul>
<li>
<p>First, annotate MainActivityTest class using <b>@RunWith</b> annotation and pass <b>AndroidJUnit4.class</b> as it's parameter. </p>
<p>AndroidJUnitRunner basically helps in running the JUnit test classes including those using Espresso testing framework. </p>
 <br><br>
<script src="https://gist.github.com/mohak1283/227cb73deb46a24387b29477e70948b1.js"></script>
</li>
<li>
<p>Now, we will define the <b>ActivityTestRule</b> using <b>@Rule</b> annotation. 
</p>
<p>ActivityTestRule basically provides functional testing of a single Activity. By using ActivityTestRule, the testing framework launches the activity under test before each test method annotated with <b>@Test</b> and before any method annotated with <b>@Before</b> </p>
<p>In the below code, we are creating the rule for <b>MainActivity</b> so that MainActivity launches before the method annotated with <b>@Test</b> executes.</p>
<b>NOTE: ActivityTestRule should always be defined as public</b>
<br><br>
<script src="https://gist.github.com/mohak1283/cd68798055998e65353f2837bea60ef7.js"></script>
</li>
</ul>
<br><br><br>

<h3 id='creatingLoginSuccessTest'>Creating Login Success Test</h3>
<br>
In this section, we will create our first UI test which will be of Login Success.
<br><br>
<ul>
<li>
<p>First, create the public method <b>checkingLoginSuccess</b> and annotate this method with <b>@Test</b> annotation.</p>
<p>By annotating the method with <b>@Test</b> annotation, we are mentioning that this is the method which runs the desired UI Test.</p>
	<br><br>
<script src="https://gist.github.com/mohak1283/1d376fbd33c9fa68dde0162a5a590d3b.js"></script>
</li>
<li>
<p> Now, paste the below code inside <b>checkLoginSuccess()</b> method.
</p>
<ul>
<li>	
<p>In the below code, first, we are finding the <b>Email Id EditText</b> using <b>onView()</b> method and <b>withId()</b> method. Basically, we are finding the email id EditText using it's id defined in <b>activity_main.xml</b> file 
</p>
<p>After finding the view, we are performing some operation on that EditText using <b>perform()</b> method. <b>perform()</b> method is basically used for performing user interaction on the specified view. </p>
<p>And, after that we are passing <b>typeText()</b> method as the parameter to the <b>perform()</b> method. <b>typeText()</b> method basically types the specified text on the specified EditText. In this case, we are typing <b>"mohak123@gmail.com"</b> and after that we are passing <b>closeSoftKeyboard()</b> method as the second parameter to the perform() method. <b>closeSoftKeyboard()</b> method basically closes the keyboard after typing in the EditText</p>
</li>
<br><br>
<li>
After that, we are repeating the same procedure for <b>password EditText</b>. We are typing <b>"mohak1234"</b> in the password field and closing the keyboard using <b>closeSoftKeyboard()</b> method.
</li>
<br><br>
<li>
After typing email id and password in their respective fields, we are performing click operation on <b>Login Button</b> using <b>click()</b> method.
</li>
<br><br>
<li>
Finally, we are checking if the <b>result TextView</b> text matches with <b>"LOGIN SUCCESS!"</b> text, because, when email and password is <b>"mohak123@gmail.com"</b> and <b>"mohak1234"</b> then result TextView displays <b>"LOGIN SUCCESS!"</b>text.
</li>
<br><br>
<li>
	Google provides a cheatsheet for Espresso UI Testing. You can get the cheatsheet from <a href="https://developer.android.com/training/testing/espresso/cheat-sheet" target="_blank" rel="nofollow">here</a>.
</li>
<br><br>
</ul>	
<br><br>
<script src="https://gist.github.com/mohak1283/f0682c9aa3b65be82bc2c5e23eb307bf.js"></script>
</li>
</ul>
<br><br>
That's all, you have created your first UI test.
<br><br>
<div class="row  justify-content-center">
  <div class=" col-md-4 col-md-offset-4">
    <img class="img-fluid text-center" src = "/Users/mohakgupta/Downloads/login-success-test.gif ">
  </div>
</div>
<br><br><br>


<h3 id='creatingLoginFailedTest'>Creating Login Failed Test</h3>
<br>
In this section, we will create our second UI test which will be of Login Failure.
<br><br>
<ul>
<li>
<p>First, create the public method <b>checkingLoginFailure</b> and annotate this method with <b>@Test</b> annotation.</p>
<p>By annotating the method with <b>@Test</b> annotation, we are mentioning that this is the method which runs the desired UI Test.</p>
	<br><br>
<script src="https://gist.github.com/mohak1283/10e535db3e3f41a455ac7c64ac9945cb.js"></script>
</li>
<li>
<p> Now, paste the below code inside <b>checkLoginFailure()</b> method.
</p>
<ul>
<li>	
<p>In the below code, first, we are finding the <b>Email Id EditText</b> using <b>onView()</b> method and <b>withId()</b> method as we have done in previous step and typing <b>"mohak123@gmail.com"</b> in the Email Id field and finally closing the keyboard.
</p>
</li>
<br><br>
<li>
After that, we are repeating the same procedure for <b>password EditText</b>. We are typing <b>"mohak12345"</b> in the password field and closing the keyboard using <b>closeSoftKeyboard()</b> method.
</li>
<br><br>
<li>
After typing email id and password in their respective fields, we are performing click operation on <b>Login Button</b> using <b>click()</b> method.
</li>
<br><br>
<li>
Finally, we are checking if the <b>result TextView</b> text matches with <b>"LOGIN FAILED"</b> text, because, when email and password is <b>"mohak123@gmail.com"</b> and <b>"mohak12345"</b> then result TextView displays <b>"LOGIN FAILED"</b>text.
</li>
<br><br>
</ul>	
<br><br>
<script src="https://gist.github.com/mohak1283/10043063b61d4f6dc831901e3873c5f3.js"></script>
</li>
</ul>
<br><br>
That's all, you have created your second UI test.
<br><br>
<div class="row  justify-content-center">
  <div class=" col-md-4 col-md-offset-4">
    <img class="img-fluid text-center" src = "/Users/mohakgupta/Downloads/login-failed-test.gif ">
  </div>
</div>
<br><br><br>


That's All! Happy Coding!
<br><br><br>

The complete code is available <a href="https://github.com/mohak1283/Android-Examples/tree/master/EspressoTesting" target="_blank" rel="nofollow">here</a>.
<br><br><br>





</html>
